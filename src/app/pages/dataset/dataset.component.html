<das-container [loading]="datasetStore.loading()">

  <div class="bg-white rounded-2xl shadow-lg p-4 w-full mb-4">
    <h2 class="text-2xl font-semibold text-gray-800 mb-4 text-center">
      Cargar nuevo dataset
    </h2>
    <textarea [(ngModel)]="description" id="descripcion" name="descripcion" rows="4"
      placeholder="Escriba una descripción detallada del dataset..."
      class="w-full rounded-xl border border-gray-300 p-3 text-gray-800 placeholder-gray-400 focus:border-blue-500 focus:ring focus:ring-blue-100 resize-y"></textarea>
    <input type="file" (change)="onFileSelected($event)" class="block w-full text-sm text-gray-700
             file:mr-4 file:py-2 file:px-4
             file:rounded-full file:border-0
             file:text-sm file:font-semibold
             file:bg-blue-50 file:text-blue-700
             hover:file:bg-blue-100 mb-4" />
    <div class="flex justify-end">
      <button (click)="onUpload()" [disabled]="!formCompleted()" class="w-auto py-2 px-4 rounded-lg font-medium
             bg-softBlue text-white hover:bg-blue-700
             disabled:bg-gray-300 disabled:cursor-not-allowed
             transition-all duration-200">
        Subir archivo
      </button>
    </div>

    @if (datasetStore.progress() > 0) {
    <div *ngIf="" class="mt-6 w-full">
      <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
        <div class="bg-green-500 h-full transition-all duration-500" [style.width.%]="datasetStore.progress()"></div>
      </div>
      <p class="text-sm text-gray-600 mt-2 text-center">
        {{ datasetStore.progress() }}%
      </p>
    </div>
    }
  </div>

  @if (datasetStore.result(); as result) {
  <div class="bg-white rounded-2xl shadow-lg p-4 w-full">
    <h3 class="text-lg font-semibold mb-2">
      Resultado — Total: {{ result.rows_count }}
    </h3>

    @if (result.preview?.length > 0) {
    <!-- Scroll horizontal -->
    <div class="overflow-x-auto border rounded-lg shadow-sm">
      <table class="min-w-max w-full text-sm text-left border-collapse">
        <thead class="bg-gray-100 border-b">
          <tr>
            @for (col of Object.keys(result.preview[0]); track col) {
            <th class="px-4 py-2 font-medium text-gray-700 whitespace-nowrap">
              {{ col }}
            </th>
            }
          </tr>
        </thead>
        <tbody>
          @for (row of result.preview; track $index) {
          <tr class="border-b hover:bg-gray-50">
            @for (col of Object.keys(result.preview[0]); track col) {
            <td class="px-4 py-2 whitespace-nowrap">
              {{ row[col] }}
            </td>
            }
          </tr>
          }
        </tbody>
      </table>
      <div class="flex justify-end  gap-3 mb-6 p-4">
        <button (click)="onProcess()" class="w-auto py-2 px-4 rounded-lg font-medium
             bg-softBlue text-white hover:bg-blue-700
             disabled:bg-gray-300 disabled:cursor-not-allowed
             transition-all duration-200">
          Procesar dataset
        </button>
        <button (click)="onDelete()" class="w-auto py-2 px-4 rounded-lg font-medium
            bg-softRed text-white hover:bg-red-700
             disabled:bg-gray-300 disabled:cursor-not-allowed
             transition-all duration-200">
          Eliminar dataset
        </button>
      </div>
    </div>
    } @else {
    <p class="text-gray-500">No hay datos disponibles.</p>

    }
  </div>
  }
  @else {
  <p class="text-gray-500">Sube un archivo para ver el resultado.</p>
  }

  @if (datasetStore.error()) {
  <div class="text-red-500">
    {{ datasetStore.error().error }}
  </div>
  }

</das-container>